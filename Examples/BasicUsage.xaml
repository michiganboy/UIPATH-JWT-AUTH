<?xml version="1.0" encoding="UTF-8"?>
<Activity x:Class="SalesforceJWT.BasicUsage" xmlns="http://schemas.microsoft.com/netfx/2009/xaml/activities" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:ui="http://schemas.uipath.com/workflow/activities" xmlns:s="clr-namespace:System;assembly=mscorlib" xmlns:scg="clr-namespace:System.Collections.Generic;assembly=mscorlib">
  <Sequence DisplayName="Basic JWT Usage Example">
    <!-- Variables -->
    <Variable x:TypeArguments="x:String" Name="AccessToken" />
    <Variable x:TypeArguments="x:String" Name="InstanceUrl" />
    <Variable x:TypeArguments="s:DateTime" Name="TokenExpiry" />
    <Variable x:TypeArguments="x:String" Name="APIResponse" />
    <Variable x:TypeArguments="x:Int32" Name="StatusCode" />
    
    <!-- Step 1: Get JWT Token -->
    <ui:LogMessage DisplayName="Starting JWT Authentication" Level="Info" Message="Starting JWT authentication process..." />
    
    <ui:InvokeWorkflowFile DisplayName="Get JWT Token" WorkflowFileName="Main.xaml">
      <ui:InvokeWorkflowFile.Arguments>
        <OutArgument x:TypeArguments="x:String" x:Key="AccessToken">[AccessToken]</OutArgument>
        <OutArgument x:TypeArguments="x:String" x:Key="InstanceUrl">[InstanceUrl]</OutArgument>
        <OutArgument x:TypeArguments="s:DateTime" x:Key="TokenExpiry">[TokenExpiry]</OutArgument>
      </ui:InvokeWorkflowFile.Arguments>
    </ui:InvokeWorkflowFile>
    
    <ui:LogMessage DisplayName="JWT Authentication Complete" Level="Info" Message="[&quot;JWT authentication successful. Token expires at: &quot; + TokenExpiry.ToString()]" />
    
    <!-- Step 2: Make API Call -->
    <ui:LogMessage DisplayName="Making API Call" Level="Info" Message="Making API call to Salesforce..." />
    
    <ui:HttpRequest DisplayName="Get Account Describe" Method="GET" Url="[InstanceUrl + '/services/data/v58.0/sobjects/Account/describe']">
      <ui:HttpRequest.Headers>
        <scg:Dictionary x:TypeArguments="x:String, x:String">
          <KeyValuePair x:Key="Authorization" x:Value="[&quot;Bearer &quot; + AccessToken]" />
          <KeyValuePair x:Key="Content-Type" x:Value="application/json" />
        </scg:Dictionary>
      </ui:HttpRequest.Headers>
      <ui:HttpRequest.Result>
        <OutArgument x:TypeArguments="x:String">[APIResponse]</OutArgument>
      </ui:HttpRequest.Result>
      <ui:HttpRequest.StatusCode>
        <OutArgument x:TypeArguments="x:Int32">[StatusCode]</OutArgument>
      </ui:HttpRequest.StatusCode>
    </ui:HttpRequest>
    
    <!-- Step 3: Check Response -->
    <If DisplayName="Check API Response">
      <If.Condition>
        <InArgument x:TypeArguments="x:Boolean">[StatusCode = 200]</InArgument>
      </If.Condition>
      <If.Then>
        <ui:LogMessage DisplayName="API Call Successful" Level="Info" Message="API call completed successfully!" />
        <ui:LogMessage DisplayName="Response Length" Level="Info" Message="[&quot;Response length: &quot; + APIResponse.Length.ToString() + &quot; characters&quot;]" />
      </If.Then>
      <If.Else>
        <ui:LogMessage DisplayName="API Call Failed" Level="Error" Message="[&quot;API call failed with status code: &quot; + StatusCode.ToString()]" />
        <ui:LogMessage DisplayName="Error Response" Level="Error" Message="[&quot;Error response: &quot; + APIResponse]" />
      </If.Else>
    </If>
    
    <!-- Step 4: Complete -->
    <ui:LogMessage DisplayName="Example Complete" Level="Info" Message="Basic JWT usage example completed successfully!" />
  </Sequence>
</Activity>
